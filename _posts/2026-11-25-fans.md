---
layout: distill
title: FANS
description: TBD
date: 2026-04-27
future: true
htmlwidgets: true
hidden: true

# Mermaid diagrams
mermaid:
  enabled: true
  zoomable: true

# Anonymize when submitting
authors:
  - name: Anonymous

# must be the exact same name as your blogpost
bibliography: 2026-11-25-fans.bib

# Add a table of contents to your post.
#   - make sure that TOC names match the actual section names
#     for hyperlinks within the post to work correctly.
#   - please use this format rather than manually creating a markdown table of contents.
toc:
  - name: Equations
  - name: Images and Figures
    subsections:
      - name: Interactive Figures
  - name: Citations
  - name: Footnotes
  - name: Code Blocks
  - name: Diagrams
  - name: Tweets
  - name: Layouts
  - name: Other Typography?

---

### Plan

## Motivations

Diffusion models have achived state of the art performances on data modalities like Stable diffusion for images, Sora for videos, RFdiffusion for protiens and Mattergen for materials [cite]. They work by learning to reverse a gradual noising process. In a **Forward Pass**  the data modality is progressively corrupted with gaussian noise until it becomes complete noise. In the **backward process** the model learns a denoiser which start from a gaussian noise and denoise this step-by-step to get an apprxomately clean sample. While this framework has proven to be quite effective, the existing works treats the noise and spatially uniform gaussian noise $$\mathcal{N}(\mu, \sigma^2)$$.  

The modalities mentioned above have one thing in common. They exibits __power law__ in their Fouries representation. That is, the low-frequency components have orders of magnitude higher variance than high-frequency components [cite][image]. To interpret the fourier component through visual representation, low frequencies capture the global structure while the high frequency encodes the finer details. On viewing diffusion though the fouries lens of the data, it has an important implications: The DDPM **[make diffusion to DDPM and define earlier in text]** forward process noises high-frequency components substantially earlier and faster as compared to the low frequency components. This can be attributed to the fact that Gaussian noise is applied irrespective of the data's spectral content as we show later.

Since the introduced Gaussian noise is agnostic to the data's spectral characteristics, the forward process thereby imposes a hierarchy of frequencies during generation. As the higher frequencies are noised earler and faster in the forward process, and DDPM learns to reverse this forward process: during backward process the higher frequencies are generated later conditioned on the forward process[give a figure]. Previous work has observed this phenomenon of imposed hierarchy of frequencies during generation[cite flake]

Images aren't spectrally flat. Natural images concentrate most of their power in lower frequencies following characteristic power-law distributions[give image example], while images from domains like Astronomy, Texture Design have varied concentration of pwer across the frequency bands[give image example]. This raises a fundamental question: if datasets have inherent frequency biases and the denoising trajectory naturally progresses from coarse-to-fine structure, why do we apply the same uniform white noise at every timestep and across all frequencies? How does this same uniform white noise across all frequencies perform across images form varied domain? Our research asks whether we can explicitly shape the noise spectrum to (i) match each dataset's actual frequency distribution and (ii) implement a principled time-frequency annealing schedule—shifting from low to high frequencies as denoising progresses—to improve sample quality and training stability without modifying the underlying UNet architecture or DDPM objective.

## Quick Overview

Let's start with a quick overview of the two frameworks we will be working with: Diffusion models and Frequency domain of Images.

### Diffusion Models

### Forward Process

It defines a markov chain that progressively add gaussian noise to the data sample $$\mathbf{x}_0 \sim q(\mathbf{x}_0)$$ over $$T$$ timesteps. Each timestep adds a slight noise to the data resulting in a increasingly noisy samples $$\mathbf{x}_1, \mathbf{x}_2, \dots, \mathbf{x}_T$$, where $\mathbf{x}_T$ approximates an isotropic Gaussian distribution.
The forward process is formally defined as :

$$
    q(\mathbf{x}_t | \mathbf{x}_{t-1}) = \mathcal{N}(\mathbf{x}_t; \sqrt{1 - \beta_t} \, \mathbf{x}_{t-1}, \beta_t \mathbf{I}),
$$

where $\beta_t \in (0,1)$ controls the amount of noise added to the data. 

By applying the reparameterization reccursively we obtain the closed form experssion

$$
q(\mathbf{x}_t | \mathbf{x}_0) = \mathcal{N}(\mathbf{x}_t; \sqrt{\bar{\alpha}_t} \, \mathbf{x}_0, (1 - \bar{\alpha}_t)\mathbf{I}),
$$


where $$\alpha_t = 1 - \beta_t$$ and $$\bar{\alpha}_t = \prod_{s=1}^t \alpha_s$$. 

Thus the noisy data at any given time $$t$$ in the forward proccess

$$
\mathbf{x}_t = \sqrt{\bar{\alpha}_t}\mathbf{x}_0 + \sqrt{(1 - \bar{\alpha}_t)}\epsilon
$$

where $$\epsilon \in \mathcal{N}(0,\mathbf{I})$$.

A useful notation in this is the log signal-to-noise ration $$\lambda_t = log(\bar{\alpha}_t / (1 - \bar{\alpha}_t))$$ which increases monotonically from 0 ( clean data) to 1 (noise)

### Reverse Process

The Reverse process tries to invert the forward process, transforming Gaussian noise $$\mathbf{x}_T \sim \mathcal{N}(\mathbf{0}, \mathbf{I})$$ 
back into a data sample resembling the data distribution $$q(\mathbf{x}_0)$$. Since the true reverse transitions 
$$q(\mathbf{x}_{t-1} | \mathbf{x}_t)$$ are intractable, a parameterized model $$p_\theta(\mathbf{x}_{t-1} | \mathbf{x}_t)$$ 
is trained to approximate them.

The reverse process is modeled as:

$$
p_\theta(\mathbf{x}_{t-1} | \mathbf{x}_t) = \mathcal{N}(\mathbf{x}_{t-1}; \boldsymbol{\mu}_\theta(\mathbf{x}_t, t), \boldsymbol{\Sigma}_\theta(\mathbf{x}_t, t)),
$$

where $$\boldsymbol{\mu}_\theta$$ and $$\boldsymbol{\Sigma}_\theta$$ are outputs of a neural network conditioned on 
$$\mathbf{x}_t$$ and the timestep $$t$$. The model learns to predict the mean of the denoised sample at each step.

Using the forward process derivation, the true mean of 
$$q(\mathbf{x}_{t-1} | \mathbf{x}_t, \mathbf{x}_0)$$ can be expressed as:

$$
\boldsymbol{\mu}_q(\mathbf{x}_t, \mathbf{x}_0) = \frac{1}{\sqrt{\alpha_t}} \left( \mathbf{x}_t - 
    \frac{\beta_t}{\sqrt{1 - \bar{\alpha}_t}} \boldsymbol{\epsilon} \right),
$$

where $$\boldsymbol{\epsilon}$$ denotes the Gaussian noise added at timestep $$t$$. 

On way of learning is during training, the model is optimized to predict this noise directly using a loss of the form:

$$
L(\theta) = 
    \mathbb{E}_{t, \mathbf{x}_0, \boldsymbol{\epsilon}} 
    \left[ 
        \left\| 
            \boldsymbol{\epsilon} - 
            \boldsymbol{\epsilon}_\theta(
                \sqrt{\bar{\alpha}_t}\mathbf{x}_0 + 
                \sqrt{1 - \bar{\alpha}_t}\boldsymbol{\epsilon}, t
            ) 
        \right\|^2 
    \right],
$$

which corresponds to a reweighted variational bound on the data likelihood.

### Fouries Domain
Natural Images have rich structures in the frequency domain that is obscured in the pixel space. Understanding this frequency domain perspective is crucial for our investigation.

Let's say we have an image $$x \in \mathbf{R}_{H \times wW\times C}$$. Its pixels are coeefcient of a standard basis $$\mathcal{B} = \{ \mathbf{e}_1, \mathbf{e}_2, \dots, \mathbf{e}_n \} \subset \mathbb{R}^n$$. In the spatial domain, the image is defined as a linear combination of standard basis vectors, where each pixel represents a local real-valued intensity. When we apply the Discrete Fourier Transform(DFT) to this image, it performs unitary change of basis giving us the frequency domain equivalent of the image. The dimension of the fourier and the pixel image remains the same but in fourier domain the coeeficients of the basis becoms complex valued [Give Figure].

For each channel of an image the DFT can be formulated as

$$
F(u, v) = \sum_{x=0}^{H-1} \sum_{y=0}^{W-1} f(x, y) e^{-j 2\pi \left( \frac{ux}{H} + \frac{vy}{W} \right)}
$$

where $$(u,v)$$ aer spatial frequency indices. The radial frequency $$f = \sqrt{u^2 + v^2}$$ measure the distance from the DC ( zero frequency component)

Now, let's sort the Fourier coeeficient $$f(u,v)$$ from low to high frequency. To do so, we start from the center of our Fourier Space and walk in spirals. That is, sort them using the Manhatten distancen of the indices $$(uv,)$$ from the center (0,0) of the Fourier representation. Figure [plot figure] shows the plot of running average of dimension-wise signal variance for images. It's very evident that signal variance decreases rapidly with increasing frquency. [cite fabian paper] shows that similar trend is visible in other doains as well.

**Power Spectral Density(PSD)**: This quantifies how the signal enery is distributed across frequencies. For an image with Fourier Transform $$F(u,v)$$, PSD is defined as :

$$
P(u,v) = |F(u,v)|^2
$$

representing the power at each frequency component. To get one dimensional spectral profile we compute the radially-average PSD by integrating over annular regions at constant radial frequency $$f$$ (simply put average power in ring-shaped zones moving outward from the center). Formally put

$$
P(f) = \frac{1}{|B_f|} \sum{}_{(u,v) \in B_f} |F(u,v)|^2
$$

Where $$B_f$$ is the radial frequency band defined as $$B_f = {(u,v): f \leq \sqrt{u^2+v^2} \le f+ \delta f}$$ and $$\|B_f\|$$ is the number of frequencies in that band.

The PSD reveals how much each frequency contributes to the overall signal. For a dataset of images, we compute per-image PSDs and average them to obtain a dataset-level spectral profile. This aggregate PSD characterizes the typical frequency distribution of the data and captures domain-specific properties

Real-world image datasets exhibit characteristic frequency distributions. The power spectral density of natural images typically follows a power-law decay:

$$ P \propto f^{-\alpha} $$

Emperical studies on natural image statistics shave shown that $$\alpha$$ typically resides in the interval [1,3] <d-cite key="field,physrevLett"> </d-cite>. While Standard photgraphic images generally converges towards $$\alpha \approx 2$$ <d-cite key="vanHateren1992"></d-cite> as we demonstrate in Figure [Give figure], For few domain specific datasets like Astronomy images, we observe this trend $$\alpha \approx 1$$.

To quantify dataset frequency importance, we divide the spectrum into $$B$$ radial frequency bands and compute the normalized band power $$\pi_b$$​ for each band $$B$$:

$$
\pi_b = \frac{1}{N}\sum{N}_{i=1} \frac{\sum{}_{f \in B_i}P_i(f)}{\sum{}_{f} P_i(f)}
$$

where $$N$$ is the number of images in the dataset and $$P_i(f) is the PSD of image $$i$$. These band powers $${\pi_b}^B_{b=1}$$​ form a probability distribution over frequency bands, representing how the dataset's signal energy is distributed across the spectrum.

### Diffusion in Frequency Domain

As we are trying to investigate how the DDPMs inductive bias in the forward process<d-cite key="falck2025fourierspaceperspectivediffusion"></d-cite> affects datasets for varying spectral power density, we can view the DDPM forward process under a chnage of basis to fourier space <d-cite key="dielman,gerdes2024gudgenerationunifieddiffusion"></d-cite>. This is acomplished by applying the Fourier transform $$\mathbf{F}$$ to the variable $$x_t$$

$$
y_t : \mathbf{F}\mathbf{x}_t = \mathbf{F}\sqrt{\bar{\alpha}_t}\mathbf{x}_0 + \mathbf{F}\sqrt{(1 - \bar{\alpha}_t)}\epsilon
$$

Here, $$y_t$$ is our fourier-transformed intermediate step at time step $$t$$ of the forward process.

Taking the quantification of Signal-to-noise Ration from <d-cite key="falck2025fourierspaceperspectivediffusion"></d-cite>, where SNR of $$(x_t)_i$$ is the signal to noise ration of frquescy $$i$$ at timestep $$t$$. Formally put

$$
 SNR((x_t)_i) = \frac{\bar{\alpha_t}\varsigma_i}{1-\bar{\alpha_t}}
$$

Where $$\varsigma_i = Var(x_0)_i$$ represents the signal variance of requency $$i$$.


Tying these all together, we see in Figure [Give that heatmap figure ], that standard DDPM corrupts high-frequencies faster than low frequencies. This bias is carry forwarded to the reverse process as well. [rethink this as per pdf]

Thus we want to study an alternate noising schedule that respects the datasets spectral signature. To put simply a Frequency Adaptive Noise Scheduler ( FANS ).


## FANS
In the previous sections we saw the inductive bias of DDPM towards high frequency components both in forward and reverse process. We want to investigate if instead of isotropic gaussian noise scheduler (irrespective of the frequency distribution of the dataset), we use a scheduler that is adaptive to the intrinsic frequency characteristic of the dataset by constructing spectrally-shaped noise. Our key insight is that different frequency bands contribute unequally to perceptual quality and should be treated accordingly during both training and generation.

This proposed approach, operates through three complementary mechanism :
1. **Dataset importance profiling**: We analyze the spectraal distribution of the data to compute frequency band importance weight $$g_b$$ that quantifies the relative contribution of each band of the overall data.
2. **Time-Frequency Scheduling**: We introduce a temporal ramping function $$\phi(t)$$ that smoothly transitions noise allocation from low to high frequencies as the diffusion process evolves, enabling coarse-to-fine generation.
3. **Variance-Compensated Weighting**: We apply inverse-power weighting to band importances, ensuring that underrepresented high-frequency bands receive compensatory emphasis during training.

We can now formalize these mechanism:

### Radial Frequency Band Decomposition 

Recalling from previous discussion, let's $$x_0 \in \mathbb{R}^{H \times W \times C}$$ denote a clean image, and let $$\mathcal{F}$$ denote the real-valued FFT used in the implementation. To characterise the dataset's spectral structure, we partition the $$B$$ radial frequency bands $$\{B_b\}_{b=1}^B$$ in the discrete $$r$$FFT layout (shape $$H \times W/2 + 1$$) using linear radial boundaries. For each band $$b$$ we define :
- **Band mask** : $$B_b \in \{0,1\}^{H \times W/2 + 1}$$ indicating membership.
- **Band size** : |$$B_b$$| denotes the nuber of frequency coefficients in band $$b$$.

Bands are constructed using radial frequency $$F(u,v) = \sqrt{u^2 + v^2}$$ with edges uniformly spaced between a small positive $$f_{min}$$ (to exclude DC component) and $$f_{mac}$$ ( Nyquist frequency = 0.5)

**Intuition** : Excluding the DC component (zero frequency) is critical because it represents the global mean intensity, which dominates the spectrum but carries minimal perceptual information. Including DC in band 0 would artificially inflate its importance $$g_0$$ and distort the learned weighting.

### Dataset Importance Profiling
For each image $$x$$ in the training set, we compute the **normalized band power** $$\pi_b(x)$$ as ;

$$
 \pi_b(x) = \frac{\sum{}_{k \in B_b} |F(x - \bar{x})(k)|^2 }{\sum^{B-1}_{b^\prime = 0 }\sum{}_{k \in B_{b^\prime}} |F(x - \bar{x})(k)|^2 }
$$

wher $$\bar{x}$$  is the per image mean ( removing DC ). This gives the fraction of total power residing in band $$b$$ for image $$x$$.

We then compute the dataset-level band distribution by averaging over $$N$$ samples:

$$
  \bar{\pi} = \frac{1}{N} \sum^{N}_{i=1} \pi_b(x_i)
$$


Note that $$\sum^{B-1}_{b=0} \bar{\pi_b} = 1 $$ by construction.

Finally, we compute importance weights via inverse-power scaling rule :

$$
g_b = \frac{(\bar{\pi_b} + \epsilon )^{-\alpha}}{\frac{1}{B}\sum^{B-1}_{b^\prime=0}(\bar{\pi_{b^\prime}} + \epsilon)^{-\alpha}}
$$

wher $$\alpha$$ controls the strength of variance compensation. The standardization ensures $$g_b$$ has zero mean and unit variance, provising a stable range for the softmax reweighting.

**Intuition**: Bands with low power $$\bar{\pi_b} $$(e.g., high frequencies) receive higher importance $$g_b$$ ​, compensating for their underrepresentation in the data. This prevents the model from neglecting high-frequency reconstruction.

### Time-Dependent Soft Band Weighting [check once]

At each timestep $$t∈[0,1]$$t \in [0,1]$$, we compute soft band weights $$w_b(t)$$ via a temperature-scaled softmax with time-frequency ramping:

$$
w_b(t) = \frac{exp(\beta.g_b - \gamma.\phi(t).\lambda_b)}{\sum^{B-1}_{b^\prime = 0}exp(\beta.g_b^\prime - \gamma.\phi(t).\lambda_b^\prime)}
$$

where:
- $$\lambda_b = b/(B-1)$$ is the normalized band index $$\lambda_0 = 0, \lambda_{B-1}=1$$
- $$\pi(t) \in [0,1]$$ is a temporal ramp.
- $$\beta,\gamma \ge 0$$ are the invese temperature hyperparameter.


Early in the diffusion process, the term $$\beta. g_b$$ dominates, emphasizing frequencies according to dataset statistics.
As $$t$$ increases, the ramp $$\phi(t)$$ gradually increases the influence of $\gamma\lambda_b$, making the spectrum increasingly uniform.


**Stabilization: White Noise Guardrail** To ensure stable training during the earliest timesteps, we introduce a white noise mixing schedule:

$$
w_b^{\text{mix}}(t) = \begin{cases}
\frac{1}{B} & \text{if } t < t_{\text{knee}} \\
(1 - \alpha_{\text{mix}}(t)) \cdot \frac{1}{B} + \alpha_{\text{mix}}(t) \cdot w_b(t) & \text{if } t \geq t_{\text{knee}}
\end{cases}
$$

where $$\alpha_{\text{mix}}(t) = \frac{t - t_{\text{knee}}}{1 - t_{\text{knee}}}$$​​ is a linear blend coefficient and $$t_{\text{knee}} = 0.15$$ by default.

**Intuition**: At very small $$t$$, the noised samples $$x_t \approx \beta_t \epsilon$$ are nearly pure noise. Enforcing strong spectral shaping here can destabilize training because the model has insufficient signal to learn meaningful structure. By using uniform weights early, we ensure the model first learns to denoise white noise (as in standard DDPM), then gradually transitions to FANS-shaped noise.





## Data Generation
**Need for synthetic data**
- PBLT
- EGM
**Real World data**
- Multimodal Universe
- Texture dataset
Results
- show closeup
- show bands of regenerated image
- FID on real world data
- qualitative samples of the real data
